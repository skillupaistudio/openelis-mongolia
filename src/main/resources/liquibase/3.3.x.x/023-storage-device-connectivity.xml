<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.0.xsd">

    <changeSet id="storage-ogc68-001-add-device-connectivity-columns" author="dev-team">
        <comment>Add connectivity configuration fields (IP, port, protocol) to storage_device table for network-connected equipment</comment>
        <addColumn tableName="storage_device">
            <column name="ip_address" type="VARCHAR(45)">
                <constraints nullable="true"/>
            </column>
            <column name="port" type="INTEGER">
                <constraints nullable="true"/>
            </column>
            <column name="communication_protocol" type="VARCHAR(20)">
                <constraints nullable="true"/>
            </column>
        </addColumn>
        <rollback>
            <dropColumn tableName="storage_device" columnName="ip_address"/>
            <dropColumn tableName="storage_device" columnName="port"/>
            <dropColumn tableName="storage_device" columnName="communication_protocol"/>
        </rollback>
    </changeSet>

    <changeSet id="storage-ogc68-002-add-port-check-constraint" author="dev-team">
        <comment>Add check constraint for valid port range (1-65535)</comment>
        <sql>
            ALTER TABLE storage_device
            ADD CONSTRAINT chk_storage_device_port_range
            CHECK (port IS NULL OR (port >= 1 AND port &lt;= 65535));
        </sql>
        <rollback>
            <sql>ALTER TABLE storage_device DROP CONSTRAINT chk_storage_device_port_range;</sql>
        </rollback>
    </changeSet>

</databaseChangeLog>
